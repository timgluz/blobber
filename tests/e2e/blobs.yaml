title: test blobs endpoints with valid authorization
secrets:
  BLOBBER_API_TOKEN: valid_token_123
steps:
  - title: delete leftover newblob.txt
    protocol: http
    request:
      method: DELETE
      url: http://localhost:8080/blobs/newblob.txt
      header:
        X-API-Token: "{{secrets.BLOBBER_API_TOKEN}}"
    expect:
      code: No Content

  - title: get blobs
    protocol: http
    request:
      method: GET
      url: http://localhost:8080/blobs
      header:
        X-API-Token: "{{secrets.BLOBBER_API_TOKEN}}"
    expect:
      code: OK
      body:
        items: ["test.json"]
  - title: get blobs by prefix
    protocol: http
    request:
      method: GET
      url: http://localhost:8080/blobs?prefix=te
      header:
        X-API-Token: "{{secrets.BLOBBER_API_TOKEN}}"
    expect:
      code: OK
      body:
        items: ["test.json"]
  - title: get blob
    protocol: http
    request:
      method: GET
      url: http://localhost:8080/blobs/test.json
      header:
        X-API-Token: "{{secrets.BLOBBER_API_TOKEN}}"
    expect:
      code: OK
      body: '{"success": true}'
  - title: get non-existing blob
    protocol: http
    request:
      method: GET
      url: http://localhost:8080/blobs/non-existing.json
      header:
        X-API-Token: "{{secrets.BLOBBER_API_TOKEN}}"
    expect:
      code: Not Found
      body: "Blob not found\n"
  - title: upload blob
    protocol: http
    request:
      method: PUT
      url: http://localhost:8080/blobs/newblob.txt
      header:
        X-API-Token: "{{secrets.BLOBBER_API_TOKEN}}"
      body: newblob
    expect:
      code: Created
  - title: get uploaded blob as text
    protocol: http
    request:
      method: GET
      header:
        Accept: text/plain
        X-API-Token: "{{secrets.BLOBBER_API_TOKEN}}"
      url: http://localhost:8080/blobs/newblob.txt
    expect:
      code: OK
      body: "\"newblob\"\n"
  - title: delete blob
    protocol: http
    request:
      method: DELETE
      url: http://localhost:8080/blobs/newblob.txt
      header:
        X-API-Token: "{{secrets.BLOBBER_API_TOKEN}}"
    expect:
      code: No Content
  - title: get deleted blob
    protocol: http
    request:
      method: GET
      url: http://localhost:8080/blobs/newblob.txt
      header:
        X-API-Token: "{{secrets.BLOBBER_API_TOKEN}}"
    expect:
      code: Not Found
      body: "Blob not found\n"
